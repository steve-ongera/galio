{% extends "base.html" %}

{% block content %}
<!-- breadcrumb area start -->
<div class="breadcrumb-area">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="breadcrumb-wrap">
                    <nav aria-label="breadcrumb">
                        <ul class="breadcrumb">
                            <li class="breadcrumb-item"><a href="{% url 'index' %}">Home</a></li>
                            <li class="breadcrumb-item"><a href="{% url 'cart' %}">Cart</a></li>
                            <li class="breadcrumb-item"><a href="{% url 'checkout' %}">Checkout</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Order Confirmation</li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- breadcrumb area end -->

<!-- order confirmation wrapper start -->
<div class="order-confirmation-wrapper">
    <div class="container">
        <div class="row">
            <div class="col-lg-9">
                <!-- order confirmation inner start -->
                <div class="order-confirmation-inner">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="order-success-message mb-30">
                                <div class="success-icon text-center mb-20">
                                    <i class="fa fa-check-circle"></i>
                                </div>
                                <div class="text-center">
                                    <h3>Thank You for Your Order!</h3>
                                    <p>Your order has been successfully placed and is being processed.</p>
                                    <div class="order-info mt-20">
                                        <p>Order Number: <strong>{{ order.order_number }}</strong></p>
                                        <p>Order Date: <strong>{{ order.created_at|date:"F d, Y" }}</strong></p>
                                        {% if order.estimated_delivery %}
                                        <p>Estimated Delivery: <strong>{{ order.estimated_delivery|date:"F d, Y" }}</strong></p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- order confirmation inner end -->

                <!-- order details section start -->
                <div class="order-details-section mt-34">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="order-review-info">
                                <ul class="nav review-tab">
                                    <li>
                                        <a class="active" data-toggle="tab" href="#order_summary">Order Summary</a>
                                    </li>
                                    <li>
                                        <a data-toggle="tab" href="#shipping_info">Shipping & Billing</a>
                                    </li>
                                    <li>
                                        <a data-toggle="tab" href="#payment_info">Payment Details</a>
                                    </li>
                                </ul>
                                <div class="tab-content reviews-tab">
                                    <div class="tab-pane fade show active" id="order_summary">
                                        <div class="tab-one">
                                            <div class="order-items-table">
                                                <table class="table">
                                                    <thead>
                                                        <tr>
                                                            <th>Product</th>
                                                            <th>Quantity</th>
                                                            <th>Unit Price</th>
                                                            <th>Total</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for item in order_items %}
                                                        <tr>
                                                            <td>
                                                                <strong>{{ item.product.name }}</strong>
                                                                {% if item.variant %}
                                                                <br><small>{{ item.variant.name }}</small>
                                                                {% endif %}
                                                                {% if item.product.sku %}
                                                                <br><small>SKU: {{ item.product.sku }}</small>
                                                                {% endif %}
                                                            </td>
                                                            <td>{{ item.quantity }}</td>
                                                            <td>ksh{{ item.unit_price }}</td>
                                                            <td>ksh{{ item.total_price }}</td>
                                                        </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                    <tfoot>
                                                        <tr>
                                                            <td colspan="3"><strong>Subtotal</strong></td>
                                                            <td><strong>ksh{{ order.subtotal }}</strong></td>
                                                        </tr>
                                                        {% if order.discount_amount and order.discount_amount > 0 %}
                                                        <tr>
                                                            <td colspan="3">
                                                                Discount
                                                                {% if order.coupon_code %}
                                                                ({{ order.coupon_code }})
                                                                {% endif %}
                                                            </td>
                                                            <td>-ksh{{ order.discount_amount }}</td>
                                                        </tr>
                                                        {% endif %}
                                                        <tr>
                                                            <td colspan="3">Shipping</td>
                                                            <td>
                                                                {% if order.shipping_amount == 0 %}
                                                                    Free
                                                                {% else %}
                                                                    ksh{{ order.shipping_amount }}
                                                                {% endif %}
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td colspan="3">Tax</td>
                                                            <td>ksh{{ order.tax_amount }}</td>
                                                        </tr>
                                                        <tr class="total-row">
                                                            <td colspan="3"><strong>Total Amount</strong></td>
                                                            <td><strong>ksh{{ order.total_amount }}</strong></td>
                                                        </tr>
                                                    </tfoot>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="shipping_info">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h5>Billing Address</h5>
                                                <address>
                                                    {{ order.billing_address|linebreaks }}
                                                </address>
                                            </div>
                                            <div class="col-md-6">
                                                <h5>Shipping Address</h5>
                                                <address>
                                                    {{ order.shipping_address|linebreaks }}
                                                </address>
                                            </div>
                                        </div>
                                        {% if order.notes %}
                                        <div class="mt-20">
                                            <h5>Order Notes</h5>
                                            <p>{{ order.notes|linebreaks }}</p>
                                        </div>
                                        {% endif %}
                                    </div>
                                    <div class="tab-pane fade" id="payment_info">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h5>Payment Method</h5>
                                                <p>
                                                    {% if order.payment_method == 'mpesa' %}
                                                        M-Pesa
                                                    {% elif order.payment_method == 'cash' %}
                                                        Cash on Delivery
                                                    {% elif order.payment_method == 'bank' %}
                                                        Bank Transfer
                                                    {% elif order.payment_method == 'card' %}
                                                        Credit/Debit Card
                                                    {% else %}
                                                        {{ order.payment_method|capfirst }}
                                                    {% endif %}
                                                </p>
                                                {% if order.payment_status %}
                                                <p><strong>Payment Status:</strong> {{ order.payment_status|capfirst }}</p>
                                                {% endif %}
                                            </div>
                                            <div class="col-md-6">
                                                <h5>Order Status</h5>
                                                <p>{{ order.status|capfirst }}</p>
                                                {% if order.tracking_number %}
                                                <p><strong>Tracking Number:</strong> {{ order.tracking_number }}</p>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- order details section end -->

                <!-- action buttons start -->
                <div class="order-actions mt-34">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="action-buttons text-center">
                                <div class="quantity-cart-box d-flex align-items-center justify-content-center">
                                    <div class="action_link">
                                        <a class="buy-btn" href="#">
                                            View Order Details <i class="fa fa-eye"></i>
                                        </a>
                                    </div>
                                    <div class="action_link ml-10">
                                        <a class="buy-btn" href="{% url 'index' %}">
                                            Continue Shopping <i class="fa fa-shopping-cart"></i>
                                        </a>
                                    </div>
                                    {% if order.status != 'delivered' and order.status != 'cancelled' %}
                                    <div class="action_link ml-10">
                                        <a class="buy-btn" href="#">
                                            Track Order <i class="fa fa-truck"></i>
                                        </a>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- action buttons end -->
            </div>

            <!-- sidebar start -->
            <div class="col-lg-3">
                <div class="shop-sidebar-wrap fix mt-md-22 mt-sm-22">
                    <!-- contact info start -->
                    <div class="sidebar-widget mb-22">
                        <div class="sidebar-title mb-20">
                            <h3>Need Help?</h3>
                        </div>
                        <div class="sidebar-widget-body">
                            <p>If you have any questions about your order, please contact us:</p>
                            <ul>
                                <li>
                                    <i class="fa fa-envelope"></i>
                                    <a href="mailto:support@yourstore.com">support@yourstore.com</a>
                                </li>
                                <li>
                                    <i class="fa fa-phone"></i>
                                    <a href="tel:+1234567890">+1 (234) 567-890</a>
                                </li>
                                <li>
                                    <i class="fa fa-comments"></i>
                                    <span>Live Chat Available 24/7</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <!-- contact info end -->

                    <!-- confirmation notice start -->
                    <div class="sidebar-widget mb-22">
                        <div class="sidebar-title mb-20">
                            <h3>Important</h3>
                        </div>
                        <div class="sidebar-widget-body">
                            <p>A confirmation email has been sent to <strong>{{ order.email }}</strong>.</p>
                            <p>Please keep this order number for your records: <strong>{{ order.order_number }}</strong></p>
                        </div>
                    </div>
                    <!-- confirmation notice end -->

                    <!-- order status tracking start -->
                    <div class="sidebar-widget mb-22">
                        <div class="sidebar-title mb-20">
                            <h3>Order Status</h3>
                        </div>
                        <div class="sidebar-widget-body">
                            <div class="order-status-steps">
                                <div class="status-step {% if order.status == 'confirmed' or order.status == 'processing' or order.status == 'shipped' or order.status == 'delivered' %}active{% endif %}">
                                    <i class="fa fa-check-circle"></i>
                                    <span>Order Confirmed</span>
                                </div>
                                <div class="status-step {% if order.status == 'processing' or order.status == 'shipped' or order.status == 'delivered' %}active{% endif %}">
                                    <i class="fa fa-cog"></i>
                                    <span>Processing</span>
                                </div>
                                <div class="status-step {% if order.status == 'shipped' or order.status == 'delivered' %}active{% endif %}">
                                    <i class="fa fa-truck"></i>
                                    <span>Shipped</span>
                                </div>
                                <div class="status-step {% if order.status == 'delivered' %}active{% endif %}">
                                    <i class="fa fa-check"></i>
                                    <span>Delivered</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- order status tracking end -->
                </div>
            </div>
            <!-- sidebar end -->
        </div>
    </div>
</div>
<!-- order confirmation wrapper end -->
{% endblock %}